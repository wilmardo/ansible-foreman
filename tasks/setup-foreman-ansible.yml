---
- name: Install Foreman Ansible with apt
  apt:
    name: ruby-foreman-ansible
    state: present
  when: ansible_os_family == "Debian"

- name: Install Foreman Ansible with yum
  yum:
    name: tfm-rubygem-foreman_ansible
    state: present
  when: ansible_os_family == "RedHat"

- name: Setup ansible.cfg
  linefile:
    dest: ansible.cfg.jinja2
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items:
    - { regexp: '#callback_plugins', line: 'callback_plugins   = /usr/share/ansible/plugins/callback' }
    - { regexp: 'bin_ansible_callbacks', line: 'bin_ansible_callbacks = True' }

- name: Set permanent variables
  lineinfile:
    dest: "/etc/profile"
    line: "export {{item.var}}={{ item.value }}"
    regexp: "^export {{ item.var }}"
    state: present
    insertafter: eof
  with_items: "{{ foreman_ansible_system_variables }}"
